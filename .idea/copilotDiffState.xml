<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docs/ARCHITECTURE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/ARCHITECTURE.md" />
              <option name="updatedContent" value="# Architecture de l'extension DeepBounty&#10;&#10;## Structure du projet&#10;&#10;L'extension est maintenant organisée en 3 classes principales pour une meilleure maintenabilité :&#10;&#10;### 1. `Extension.java` - Point d'entrée&#10;Le point d'entrée minimal de l'extension qui :&#10;- Initialise l'extension Burp Suite&#10;- Crée les instances de `Settings` et `Scope`&#10;- Démarre la synchronisation périodique du scope&#10;&#10;```java&#10;public class Extension implements BurpExtension {&#10;    private Settings settings;&#10;    private Scope scope;&#10;    &#10;    @Override&#10;    public void initialize(MontoyaApi api) {&#10;        // Initialisation de l'extension&#10;    }&#10;}&#10;```&#10;&#10;### 2. `Settings.java` - Gestion des paramètres&#10;Gère tous les paramètres de l'extension :&#10;- Crée et enregistre le panneau de paramètres dans Burp&#10;- Fournit l'accès aux paramètres (URL du serveur, clé API)&#10;- Valeurs par défaut configurables&#10;&#10;**Paramètres disponibles :**&#10;- `serverUrl` : URL du serveur DeepBounty (défaut : `http://localhost:8080`)&#10;- `apiKey` : Clé API pour l'authentification (optionnelle)&#10;&#10;**Méthodes publiques :**&#10;- `getServerUrl()` : Récupère l'URL du serveur&#10;- `getApiKey()` : Récupère la clé API&#10;- `isConfigured()` : Vérifie si les paramètres sont configurés&#10;&#10;### 3. `Scope.java` - Gestion du scope&#10;Contient toute la logique de synchronisation du scope :&#10;- Vérification périodique de la version du scope (toutes les 10 secondes)&#10;- Communication HTTP avec le serveur DeepBounty&#10;- Parsing des réponses JSON&#10;- Mise à jour du scope de Burp Suite&#10;&#10;**Méthodes principales :**&#10;- `startScopeVersionCheck()` : Démarre le scheduler périodique&#10;- `checkAndUpdateScope()` : Vérifie et met à jour le scope si nécessaire&#10;- `getRemoteScopeVersion()` : Récupère la version du serveur&#10;- `fetchAndUpdateScope()` : Récupère et applique le nouveau scope&#10;- `updateBurpScope()` : Parse le JSON et met à jour Burp&#10;- `getCurrentVersion()` : Obtient la version actuelle du scope&#10;- `shutdown()` : Arrête le scheduler proprement&#10;&#10;## Flux de fonctionnement&#10;&#10;```&#10;Extension.initialize()&#10;    ↓&#10;Settings créé → Panneau de paramètres enregistré dans Burp&#10;    ↓&#10;Scope créé → Scheduler démarre (10s)&#10;    ↓&#10;    ├─→ GET /scope/version → Compare versions&#10;    │   ├─→ Version identique : Log &quot;up to date&quot;&#10;    │   └─→ Version différente :&#10;    │       └─→ GET /scope → Parse JSON → Ajoute subdomains à Burp&#10;    └─→ Répète toutes les 10 secondes&#10;```&#10;&#10;## Communication avec le serveur&#10;&#10;### Endpoints utilisés&#10;&#10;#### `GET /scope/version`&#10;Récupère uniquement la version actuelle du scope.&#10;&#10;**Réponse attendue :**&#10;```json&#10;{&#10;  &quot;version&quot;: 123&#10;}&#10;```&#10;&#10;#### `GET /scope`&#10;Récupère le scope complet avec tous les sous-domaines.&#10;&#10;**Réponse attendue :**&#10;```json&#10;{&#10;  &quot;version&quot;: 123,&#10;  &quot;subdomains&quot;: [&#10;    &quot;example.com&quot;,&#10;    &quot;api.example.com&quot;,&#10;    &quot;admin.example.com&quot;&#10;  ]&#10;}&#10;```&#10;&#10;### Authentification&#10;Si une clé API est configurée, elle est envoyée dans l'en-tête :&#10;```&#10;Authorization: Bearer YOUR_API_KEY&#10;```&#10;&#10;## Avantages de cette architecture&#10;&#10;### ✅ Séparation des responsabilités&#10;- **Extension** : Orchestration&#10;- **Settings** : Configuration&#10;- **Scope** : Logique métier&#10;&#10;### ✅ Maintenabilité&#10;- Chaque classe a une responsabilité unique&#10;- Facile à tester individuellement&#10;- Modifications isolées&#10;&#10;### ✅ Extensibilité&#10;- Facile d'ajouter de nouveaux paramètres dans `Settings`&#10;- Facile d'ajouter de nouvelles fonctionnalités de scope dans `Scope`&#10;- Point d'entrée `Extension` reste simple&#10;&#10;### ✅ Réutilisabilité&#10;- `Settings` peut être étendu pour d'autres fonctionnalités&#10;- `Scope` peut être utilisé de manière autonome&#10;- Code découplé et modulaire&#10;&#10;## Fichiers de test&#10;&#10;### `test_server.py`&#10;Serveur Flask de test pour simuler l'API DeepBounty :&#10;- Endpoints `/scope/version` et `/scope`&#10;- Support de l'authentification Bearer&#10;- Endpoint `/scope/update` pour tester les mises à jour&#10;&#10;**Usage :**&#10;```bash&#10;python test_server.py&#10;# Serveur démarre sur http://localhost:8080&#10;```&#10;&#10;## Build et déploiement&#10;&#10;```bash&#10;# Build l'extension&#10;./gradlew jar&#10;&#10;# Le JAR sera dans build/libs/&#10;# Charger dans Burp : Extensions &gt; Add &gt; Sélectionner le JAR&#10;```&#10;&#10;## Logs&#10;&#10;Tous les logs sont envoyés vers l'onglet **Logger** de Burp Suite :&#10;- **Output** : Messages informatifs (scope mis à jour, etc.)&#10;- **Error** : Messages d'erreur (connexion échouée, parsing JSON, etc.)&#10;&#10;## Configuration dans Burp&#10;&#10;1. Charger l'extension&#10;2. Aller dans **Settings** &gt; **Extensions** &gt; **DeepBounty Settings**&#10;3. Configurer :&#10;   - **DeepBounty Server URL** : `http://your-server:8080`&#10;   - **Burpsuite Key** : Votre clé API (optionnel)&#10;4. La synchronisation démarre automatiquement&#10;&#10;## Notes techniques&#10;&#10;- **Scheduler** : `ScheduledExecutorService` avec un thread pool de 1 thread&#10;- **HTTP Client** : `java.net.http.HttpClient` (Java 11+)&#10;- **JSON Parsing** : Parsing simple avec regex (pas de dépendance externe)&#10;- **Timeout** : 10 secondes pour chaque requête HTTP&#10;- **Intervalle** : Vérification toutes les 10 secondes (configurable dans `Scope.java`)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/ExtensionNew.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/ExtensionNew.java" />
              <option name="updatedContent" value="import burp.api.montoya.BurpExtension;&#10;import burp.api.montoya.MontoyaApi;&#10;&#10;/**&#10; * DeepBounty Burp Suite Extension&#10; * &#10; * Periodically synchronizes scope with a remote server and automatically&#10; * adds subdomains to Burp's scope when a new version is detected.&#10; */&#10;public class Extension implements BurpExtension {&#10;&#10;    private Settings settings;&#10;    private Scope scope;&#10;&#10;    @Override&#10;    public void initialize(MontoyaApi api) {&#10;        api.extension().setName(&quot;DeepBounty&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;        api.logging().logToOutput(&quot;DeepBounty extension loading...&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;&#10;        // Initialize settings&#10;        settings = new Settings(api);&#10;        &#10;        // Initialize scope manager&#10;        scope = new Scope(api, settings);&#10;        &#10;        // Start periodic scope version check (every 10 seconds)&#10;        scope.startScopeVersionCheck();&#10;&#10;        api.logging().logToOutput(&quot;DeepBounty extension loaded successfully&quot;);&#10;        api.logging().logToOutput(&quot;Configure server URL in Settings &gt; Extensions &gt; DeepBounty Settings&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/Extension_new.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/Extension_new.java" />
              <option name="updatedContent" value="import burp.api.montoya.BurpExtension;&#10;import burp.api.montoya.MontoyaApi;&#10;&#10;/**&#10; * DeepBounty Burp Suite Extension&#10; * &#10; * Periodically synchronizes scope with a remote server and automatically&#10; * adds subdomains to Burp's scope when a new version is detected.&#10; */&#10;public class Extension implements BurpExtension {&#10;&#10;    private Settings settings;&#10;    private Scope scope;&#10;&#10;    @Override&#10;    public void initialize(MontoyaApi api) {&#10;        api.extension().setName(&quot;DeepBounty&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;        api.logging().logToOutput(&quot;DeepBounty extension loading...&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;&#10;        // Initialize settings&#10;        settings = new Settings(api);&#10;        &#10;        // Initialize scope manager&#10;        scope = new Scope(api, settings);&#10;        &#10;        // Start periodic scope version check (every 10 seconds)&#10;        scope.startScopeVersionCheck();&#10;&#10;        api.logging().logToOutput(&quot;DeepBounty extension loaded successfully&quot;);&#10;        api.logging().logToOutput(&quot;Configure server URL in Settings &gt; Extensions &gt; DeepBounty Settings&quot;);&#10;        api.logging().logToOutput(&quot;=&quot;.repeat(60));&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>